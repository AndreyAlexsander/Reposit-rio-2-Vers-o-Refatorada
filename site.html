<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minhas Tarefas Digital</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root {
      --p: #0d47a1;
      --s: #1565c0;
    }

    body {
      background: #f5f7fa;
      height: 100vh;
      overflow: hidden;
    }

    .d-none { display: none !important; }

    .auth {
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--p), var(--s));
    }

    .card-auth {
      background: #fff;
      padding: 2rem;
      border-radius: 15px;
      width: 100%;
      max-width: 400px;
    }

    .main {
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 240px;
      background: #fff;
      border-right: 1px solid #ddd;
      padding: 1rem;
      display: flex;
      flex-direction: column;
    }

    .content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
      position: relative;
    }

    .task {
      background: #fff;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 5px solid var(--s);
      cursor: pointer;
    }

    .task.done {
      text-decoration: line-through;
      opacity: .6;
      pointer-events: none;
    }

    .fab {
      position: absolute;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      background: var(--p);
      color: #fff;
      font-size: 26px;
    }
  </style>
</head>
<body>

<!-- LOGIN -->
<section id="login" class="auth">
  <div class="card-auth">
    <h4 class="text-center text-primary">Login</h4>
    <input id="loginUser" class="form-control mb-2" placeholder="Usuário" required>
    <input id="loginPass" type="password" class="form-control mb-3" placeholder="Senha" required>
    <button class="btn btn-primary w-100" onclick="login()">Entrar</button>
    <p class="text-center mt-2">
      <a href="#" onclick="show('register')">Cadastrar</a>
    </p>
  </div>
</section>

<!-- CADASTRO -->
<section id="register" class="auth d-none">
  <div class="card-auth">
    <h4 class="text-center text-primary">Cadastro</h4>
    <input id="regNome" class="form-control mb-2" placeholder="Nome completo" required>
    <input id="regEmail" class="form-control mb-2" placeholder="E-mail" type="email" required>
    <input id="regUser" class="form-control mb-2" placeholder="Usuário" required>
    <input id="regPass" type="password" class="form-control mb-2" placeholder="Senha (mín. 8)" required>
    <input id="regConf" type="password" class="form-control mb-3" placeholder="Confirmar senha" required>
    <button class="btn btn-primary w-100" onclick="register()">Cadastrar</button>
    <p class="text-center mt-2">
      <a href="#" onclick="show('login')">Voltar</a>
    </p>
  </div>
</section>

<!-- HOME -->
<section id="home" class="main d-none">
  <nav class="sidebar">
    <strong>Minhas Tarefas</strong>
    <a href="#" class="mt-auto text-danger" onclick="logout()">Sair</a>
  </nav>

  <main class="content">
    <h3>Lista de Tarefas</h3>
    <div id="tasks"></div>
    <button class="fab" data-bs-toggle="modal" data-bs-target="#modalAdd">+</button>
  </main>
</section>

<!-- MODAL ADD -->
<div class="modal fade" id="modalAdd">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5>Nova Tarefa</h5>
      </div>
      <div class="modal-body">
        <input id="tTitle" class="form-control mb-2" placeholder="Título" required>
        <textarea id="tDesc" class="form-control" placeholder="Descrição"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal" onclick="clearAdd()">Cancelar</button>
        <button class="btn btn-primary" onclick="addTask()">Criar</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL EDIT -->
<div class="modal fade" id="modalEdit">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5>Editar Tarefa</h5>
      </div>
      <div class="modal-body">
        <input id="eTitle" class="form-control mb-2">
        <textarea id="eDesc" class="form-control"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button class="btn btn-danger" onclick="removeTask()">Excluir</button>
        <button class="btn btn-success" onclick="completeTask()">Concluir</button>
        <button class="btn btn-primary" onclick="saveTask()">Salvar</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  let tasks = [];
  let current = null;

  const el = id => document.getElementById(id);

  function show(sec) {
    ['login', 'register', 'home'].forEach(s =>
      el(s).classList.toggle('d-none', s !== sec)
    );
  }

  function login() {
    const storedUser = JSON.parse(localStorage.getItem('user'));
    const loginUser = el('loginUser').value;
    const loginPass = el('loginPass').value;
    
    if (loginUser === '' || loginPass === '') {
      alert('Preencha todos os campos');
      return;
    }
    
    if (storedUser && storedUser.username === loginUser && storedUser.password === loginPass) {
      show('home');
    } else {
      alert('Usuário ou senha inválidos');
    }
  }

  function register() {
    const regNome = el('regNome').value;
    const regEmail = el('regEmail').value;
    const regUser = el('regUser').value;
    const regPass = el('regPass').value;
    const regConf = el('regConf').value;
    
    if (regPass !== regConf) {
      alert('Senhas diferentes');
      return;
    }
    if (regNome.length < 3) {
      alert('Nome inválido');
      return;
    }
    if (!validateEmail(regEmail)) {
      alert('E-mail inválido');
      return;
    }
    if (regPass.length < 8) {
      alert('A senha deve ter pelo menos 8 caracteres');
      return;
    }

    // Salvar usuário no localStorage
    const newUser = {
      username: regUser,
      password: regPass,
      name: regNome,
      email: regEmail
    };
    localStorage.setItem('user', JSON.stringify(newUser));

    alert('Cadastro realizado');
    show('login');
  }

  function validateEmail(email) {
    const re = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
    return re.test(email);
  }

  function logout() {
    show('login');
  }

  function addTask() {
    const tTitle = el('tTitle').value;
    const tDesc = el('tDesc').value;
    if (!tTitle) return alert('Título obrigatório');

    tasks.push({
      id: Date.now(),
      title: tTitle,
      desc: tDesc,
      done: false
    });

    render();
    clearAdd();
    bootstrap.Modal.getInstance(el('modalAdd')).hide();
  }

  function render() {
    const container = el('tasks');
    container.innerHTML = '';

    tasks.forEach(t => {
      const div = document.createElement('div');
      div.className = 'task' + (t.done ? ' done' : '');
      div.innerHTML = `<strong>${t.title}</strong><br>${t.desc}`;
      div.onclick = () => editTask(t);
      container.appendChild(div);
    });
  }

  function editTask(t) {
    if (t.done) return;
    current = t;
    el('eTitle').value = t.title;
    el('eDesc').value = t.desc;
    new bootstrap.Modal(el('modalEdit')).show();
  }

  function saveTask() {
    current.title = el('eTitle').value;
    current.desc = el('eDesc').value;
    render();
    bootstrap.Modal.getInstance(el('modalEdit')).hide();
  }

  function removeTask() {
    tasks = tasks.filter(t => t !== current);
    render();
    bootstrap.Modal.getInstance(el('modalEdit')).hide();
  }

  function completeTask() {
    current.done = true;
    render();
    bootstrap.Modal.getInstance(el('modalEdit')).hide();
  }

  function clearAdd() {
    el('tTitle').value = '';
    el('tDesc').value = '';
  }

</script>

</body>
</html>
